# 方法区

## 栈、堆、方法区的交互关系

### 从线程共享与否的角度看

![](.gitbook/assets/screen-shot-2021-08-13-at-11.34.22-pm.png)

### 交互关系

![](.gitbook/assets/screen-shot-2021-08-13-at-11.35.07-pm.png)

## 方法区的理解

* 方法区可以看作是一块独立于Java堆的内存空间。**类\(class\)放在方法区，new的对象放在堆空间**

![](.gitbook/assets/screen-shot-2021-08-14-at-11.28.50-pm.png)

* 方法区与堆一样，是各个线程共享的内存区域。一个类只被加载一次 - 如果同时多个线程要加载一个类，只能其中一个加载
* 方法区在JVM启动时被创建，并且和堆空间一样，它的实际物理内存可以是不连续的
* 方法区的大小可以选择固定大小，也可以选择可扩展大小，和堆空间一样
* 方法区的大小决定了系统可以保存多少个类。如果系统定义了太多的类（例如：加载大量第三方jar包；Tomcat部署的工程过多；大量动态的生成反射类），导致方法区溢出，JVM会抛出内存溢出错误\(OOM\) java.lang.OutOfMemoryError: **PermGen space** \(Java7及以前\) 或者 java.lang.OutOfMemoryError: **Metaspace** \(Java8以后\)
* 关闭JVM就会释放方法区内存

## 设置方法区大小与OOM

## 方法区的内部结构

## 方法区使用举例

## 方法区的演进细节

## 方法区的垃圾回收

## 总结

